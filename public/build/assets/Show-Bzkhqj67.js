import{q as w,u as j,g as o,a as y,d as i,h as O,w as f,b as t,i as d,o as a,F as x,m as b,f as v,p as W,t as r,n as C,e as D,l as V,y as B}from"./app-Cshwuyje.js";import{_ as q}from"./AuthenticatedLayout-CPey1Cs-.js";import{_ as E,a as K}from"./PriorityBadge-CMpU8DiM.js";import{_ as P}from"./Modal-g-iHmKPZ.js";import{_ as U}from"./TextArea-Cc0FX0-M.js";const G={class:"flex items-center gap-4"},H={class:"py-8"},J={class:"grid gap-8 lg:grid-cols-3"},Q={class:"lg:col-span-2 space-y-8"},X={class:"flex items-center gap-3"},Y={class:"flex items-center gap-2"},Z={class:"mt-3 text-xl font-medium text-gray-900"},tt={class:"mt-4 whitespace-pre-wrap text-sm text-gray-600"},et={class:"border-t border-gray-100 pt-8"},st={class:"flex gap-6 border-b border-gray-100"},lt={class:"pt-6"},ot={key:0},at={class:"border-b border-gray-200 focus-within:border-gray-900 transition-colors"},rt={class:"mt-2 flex items-center justify-between"},nt={class:"flex items-center gap-2"},it={key:0,class:"text-xs text-gray-500"},dt=["disabled"],ut={class:"divide-y divide-gray-100"},ct={class:"flex items-center justify-between"},gt={class:"text-sm font-medium text-gray-900"},mt={class:"text-xs text-gray-400"},yt={class:"mt-2 whitespace-pre-wrap text-sm text-gray-600"},xt={key:0,class:"mt-2"},bt=["onClick"],ft={key:0,class:"py-8 text-center text-sm text-gray-400"},vt={key:1},ht={class:"flex items-center gap-4"},pt=["disabled"],_t={key:0,class:"mt-2 text-sm text-red-500"},kt={class:"divide-y divide-gray-100"},wt=["onClick"],Ct={class:"text-gray-600"},$t={class:"text-xs text-gray-400"},St={key:0,class:"py-8 text-center text-sm text-gray-400"},Ft={key:2},Lt={class:"divide-y divide-gray-100"},jt={class:"text-sm"},Dt={class:"font-medium text-blue-600"},Vt={class:"mt-0.5 text-gray-600"},Bt={class:"mt-1 text-xs text-gray-400"},At={key:0,class:"py-8 text-center text-sm text-gray-400"},It={class:"space-y-8"},zt={class:"mt-4 space-y-3 text-sm"},Mt={class:"mt-1 text-gray-900"},Nt={class:"mt-1 text-gray-900"},Rt={class:"mt-1 text-gray-900"},Tt={key:0},Ot={class:"mt-1 text-gray-900"},Wt={key:0,class:"border-t border-gray-100 pt-8"},qt={class:"mt-3 space-y-1"},Et=["onClick","disabled"],Kt={key:1,class:"border-t border-gray-100 pt-8"},Pt={class:"flex gap-4"},Ut={class:"p-6"},Gt={class:"mt-6 flex justify-end gap-3"},Zt={__name:"Show",props:{bug:Object,statuses:Array,priorities:Array,tags:Array,users:Array,can:Object},setup(l){const h=l,c=w("comments"),p=w(!1),$=w(null),_=w(null),A=n=>n.mime_type?.startsWith("image/"),S=n=>{A(n)?window.open(n.url,"_blank"):window.location.href=route("attachments.download",n.id)},u=j({body:"",parent_id:null,file:null}),g=j({file:null}),I=()=>{u.post(route("comments.store",h.bug.id),{onSuccess:()=>{u.reset(),_.value&&(_.value.value="")},preserveScroll:!0,forceFormData:!0})},z=()=>{g.post(route("attachments.store",h.bug.id),{onSuccess:()=>{g.reset(),$.value&&($.value.value="")},forceFormData:!0})},M=n=>{B.put(route("bugs.update",h.bug.id),{status:n},{preserveScroll:!0})},N=()=>{B.delete(route("bugs.destroy",h.bug.id))},k=n=>new Date(n).toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),F={open:"開放",in_progress:"進行中",resolved:"已解決",closed:"已關閉"},R=n=>{const e={created:"建立了問題",status_changed:"將狀態改為",priority_changed:"將優先級改為",assigned:"指派了問題",commented:"新增了留言",attachment_added:"新增了附件"},s={...F,low:"低",medium:"中",high:"高",critical:"緊急"},m=e[n.type]||n.type;if(n.old_value&&n.new_value){const L=s[n.old_value]||n.old_value,T=s[n.new_value]||n.new_value;return`${m} ${L} → ${T}`}return m};return(n,e)=>(a(),o(x,null,[y(i(O),{title:l.bug.title},null,8,["title"]),y(q,null,{header:f(()=>[t("div",G,[y(i(V),{href:n.route("bugs.index"),class:"text-gray-400 hover:text-gray-900"},{default:f(()=>[...e[10]||(e[10]=[v(" ← ",-1)])]),_:1},8,["href"]),e[11]||(e[11]=t("h2",{class:"text-lg font-medium text-gray-900"},"問題詳情",-1))])]),default:f(()=>[t("div",H,[t("div",J,[t("div",Q,[t("div",null,[t("div",X,[y(E,{status:l.bug.status},null,8,["status"]),e[13]||(e[13]=t("span",{class:"text-gray-300"},"·",-1)),y(K,{priority:l.bug.priority},null,8,["priority"]),l.bug.tags?.length?(a(),o(x,{key:0},[e[12]||(e[12]=t("span",{class:"text-gray-300"},"·",-1)),t("div",Y,[(a(!0),o(x,null,b(l.bug.tags,s=>(a(),o("span",{key:s.id,class:"inline-flex items-center gap-1 text-xs text-gray-600"},[t("span",{class:"h-2 w-2 rounded-full",style:W({backgroundColor:s.color})},null,4),v(" "+r(s.name),1)]))),128))])],64)):d("",!0)]),t("h1",Z,r(l.bug.title),1),t("p",tt,r(l.bug.description),1)]),t("div",et,[t("div",st,[t("button",{onClick:e[0]||(e[0]=s=>c.value="comments"),class:C(["pb-3 text-sm",c.value==="comments"?"border-b border-gray-900 text-gray-900":"text-gray-500"])}," 留言 ("+r(l.bug.comments?.length||0)+") ",3),t("button",{onClick:e[1]||(e[1]=s=>c.value="attachments"),class:C(["pb-3 text-sm",c.value==="attachments"?"border-b border-gray-900 text-gray-900":"text-gray-500"])}," 附件 ("+r(l.bug.attachments?.length||0)+") ",3),t("button",{onClick:e[2]||(e[2]=s=>c.value="activity"),class:C(["pb-3 text-sm",c.value==="activity"?"border-b border-gray-900 text-gray-900":"text-gray-500"])}," 活動 ",2)]),t("div",lt,[c.value==="comments"?(a(),o("div",ot,[t("form",{onSubmit:D(I,["prevent"]),class:"mb-6"},[t("div",at,[y(U,{modelValue:i(u).body,"onUpdate:modelValue":e[3]||(e[3]=s=>i(u).body=s),placeholder:"新增留言...",rows:3},null,8,["modelValue"])]),t("div",rt,[t("div",nt,[t("input",{ref_key:"commentFileRef",ref:_,type:"file",onInput:e[4]||(e[4]=s=>i(u).file=s.target.files[0]),class:"hidden",id:"comment-file"},null,544),e[14]||(e[14]=t("label",{for:"comment-file",class:"cursor-pointer text-sm text-gray-400 hover:text-gray-900"}," 附加檔案 ",-1)),i(u).file?(a(),o("span",it,[v(r(i(u).file.name)+" ",1),t("button",{type:"button",onClick:e[5]||(e[5]=s=>{i(u).file=null,_.value.value=""}),class:"ml-1 text-gray-400 hover:text-gray-900"},"×")])):d("",!0)]),t("button",{type:"submit",disabled:i(u).processing||!i(u).body,class:"text-sm text-gray-900 hover:underline disabled:opacity-50"},r(i(u).processing?"發表中...":"發表"),9,dt)])],32),t("div",ut,[(a(!0),o(x,null,b(l.bug.comments,s=>(a(),o("div",{key:s.id,class:"py-4"},[t("div",ct,[t("span",gt,r(s.user?.name),1),t("span",mt,r(k(s.created_at)),1)]),t("p",yt,r(s.body),1),s.attachments?.length?(a(),o("div",xt,[(a(!0),o(x,null,b(s.attachments,m=>(a(),o("button",{key:m.id,type:"button",onClick:L=>S(m),class:"mr-3 inline-flex items-center gap-1 text-xs text-gray-500 hover:text-gray-900"},[e[15]||(e[15]=t("svg",{class:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)),v(" "+r(m.original_filename),1)],8,bt))),128))])):d("",!0)]))),128)),l.bug.comments?.length?d("",!0):(a(),o("p",ft," 尚無留言 "))])])):c.value==="attachments"?(a(),o("div",vt,[t("form",{onSubmit:D(z,["prevent"]),class:"mb-6"},[t("div",ht,[t("input",{ref_key:"fileInputRef",ref:$,type:"file",onInput:e[6]||(e[6]=s=>i(g).file=s.target.files[0]),class:"text-sm text-gray-500 file:mr-3 file:border-0 file:bg-gray-100 file:px-3 file:py-1.5 file:text-sm file:text-gray-700 hover:file:bg-gray-200"},null,544),t("button",{type:"submit",disabled:!i(g).file||i(g).processing,class:"text-sm text-gray-900 hover:underline disabled:text-gray-300 disabled:no-underline"},r(i(g).processing?"上傳中...":"上傳"),9,pt)]),i(g).errors.file?(a(),o("p",_t,r(i(g).errors.file),1)):d("",!0)],32),t("div",kt,[(a(!0),o(x,null,b(l.bug.attachments,s=>(a(),o("button",{key:s.id,type:"button",onClick:m=>S(s),class:"flex w-full items-center justify-between py-3 text-left text-sm hover:text-gray-900"},[t("span",Ct,r(s.original_filename),1),t("span",$t,r((s.size/1024).toFixed(1))+" KB",1)],8,wt))),128)),l.bug.attachments?.length?d("",!0):(a(),o("p",St," 尚無附件 "))])])):c.value==="activity"?(a(),o("div",Ft,[t("div",Lt,[(a(!0),o(x,null,b(l.bug.activities,s=>(a(),o("div",{key:s.id,class:"py-4"},[t("div",jt,[t("span",Dt,r(s.user?.name),1),t("p",Vt,r(R(s)),1)]),t("p",Bt,r(k(s.created_at)),1)]))),128)),l.bug.activities?.length?d("",!0):(a(),o("p",At," 尚無活動 "))])])):d("",!0)])])]),t("div",It,[t("div",null,[e[20]||(e[20]=t("h3",{class:"text-sm font-medium text-gray-900"},"詳細資訊",-1)),t("dl",zt,[t("div",null,[e[16]||(e[16]=t("dt",{class:"text-gray-500"},"回報者",-1)),t("dd",Mt,r(l.bug.reporter?.name),1)]),t("div",null,[e[17]||(e[17]=t("dt",{class:"text-gray-500"},"負責人",-1)),t("dd",Nt,r(l.bug.assignee?.name||"未指派"),1)]),t("div",null,[e[18]||(e[18]=t("dt",{class:"text-gray-500"},"建立時間",-1)),t("dd",Rt,r(k(l.bug.created_at)),1)]),l.bug.resolved_at?(a(),o("div",Tt,[e[19]||(e[19]=t("dt",{class:"text-gray-500"},"解決時間",-1)),t("dd",Ot,r(k(l.bug.resolved_at)),1)])):d("",!0)])]),l.can.update?(a(),o("div",Wt,[e[21]||(e[21]=t("h3",{class:"text-sm font-medium text-gray-900"},"狀態",-1)),t("div",qt,[(a(!0),o(x,null,b(l.statuses,s=>(a(),o("button",{key:s,onClick:m=>M(s),disabled:l.bug.status===s,class:C(["block w-full py-1.5 text-left text-sm",l.bug.status===s?"text-gray-900":"text-gray-500 hover:text-gray-900"])},r(F[s]||s),11,Et))),128))])])):d("",!0),l.can.update?(a(),o("div",Kt,[t("div",Pt,[y(i(V),{href:n.route("bugs.edit",l.bug.id),class:"text-sm text-gray-500 hover:text-gray-900"},{default:f(()=>[...e[22]||(e[22]=[v(" 編輯 ",-1)])]),_:1},8,["href"]),l.can.delete?(a(),o("button",{key:0,onClick:e[7]||(e[7]=s=>p.value=!0),class:"text-sm text-gray-500 hover:text-red-600"}," 刪除 ")):d("",!0)])])):d("",!0)])])]),y(P,{show:p.value,onClose:e[9]||(e[9]=s=>p.value=!1),"max-width":"sm"},{default:f(()=>[t("div",Ut,[e[23]||(e[23]=t("h2",{class:"text-lg font-medium text-gray-900"},"刪除問題",-1)),e[24]||(e[24]=t("p",{class:"mt-2 text-sm text-gray-500"},"確定要刪除此問題嗎？",-1)),t("div",Gt,[t("button",{onClick:e[8]||(e[8]=s=>p.value=!1),class:"text-sm text-gray-500 hover:text-gray-900"}," 取消 "),t("button",{onClick:N,class:"border border-red-600 px-3 py-1.5 text-sm text-red-600 hover:bg-red-600 hover:text-white"}," 刪除 ")])])]),_:1},8,["show"])]),_:1})],64))}};export{Zt as default};

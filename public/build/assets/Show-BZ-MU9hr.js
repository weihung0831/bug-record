import{q as D,u as M,g as o,a as i,d as g,h as O,w as x,b as t,i as d,o as r,F as m,m as b,f as _,p as q,t as l,n as h,e as E,l as F,y as z}from"./app-Dr59Qf_n.js";import{_ as K}from"./AuthenticatedLayout-B-vAChy3.js";import{_ as U,a as W}from"./PriorityBadge-BDmruV6K.js";import{_ as G}from"./Modal-CCZj0cHL.js";import{_ as H}from"./TextArea-DngJa0Vi.js";const I={class:"flex items-center gap-4"},J={class:"py-8"},P={class:"grid gap-8 lg:grid-cols-3"},Q={class:"lg:col-span-2 space-y-8"},R={class:"flex items-center gap-3"},X={class:"flex items-center gap-2"},Y={class:"mt-3 text-xl font-medium text-gray-900"},Z={class:"mt-4 whitespace-pre-wrap text-sm text-gray-600"},tt={class:"border-t border-gray-100 pt-8"},et={class:"flex gap-6 border-b border-gray-100"},st={class:"pt-6"},at={key:0},ot={class:"mt-2 flex justify-end"},rt=["disabled"],lt={class:"divide-y divide-gray-100"},dt={class:"flex items-center justify-between"},nt={class:"text-sm font-medium text-gray-900"},it={class:"text-xs text-gray-400"},ut={class:"mt-2 whitespace-pre-wrap text-sm text-gray-600"},gt={key:0,class:"py-8 text-center text-sm text-gray-400"},mt={key:1},ct={class:"divide-y divide-gray-100"},yt=["href"],xt={class:"text-gray-600"},bt={class:"text-xs text-gray-400"},vt={key:0,class:"py-8 text-center text-sm text-gray-400"},ft={key:2},ht={class:"divide-y divide-gray-100"},pt={class:"text-sm"},_t={class:"font-medium text-gray-900"},kt={class:"text-gray-500"},wt={key:0,class:"text-gray-500"},Ct={class:"mt-1 text-xs text-gray-400"},$t={key:0,class:"py-8 text-center text-sm text-gray-400"},St={class:"space-y-8"},Vt={class:"mt-4 space-y-3 text-sm"},jt={class:"mt-1 text-gray-900"},Bt={class:"mt-1 text-gray-900"},Dt={class:"mt-1 text-gray-900"},Ft={key:0},zt={class:"mt-1 text-gray-900"},At={key:0,class:"border-t border-gray-100 pt-8"},Nt={class:"mt-3 space-y-1"},Lt=["onClick","disabled"],Tt={key:1,class:"border-t border-gray-100 pt-8"},Mt={class:"flex gap-4"},Ot={class:"p-6"},qt={class:"mt-6 flex justify-end gap-3"},Ht={__name:"Show",props:{bug:Object,statuses:Array,priorities:Array,tags:Array,users:Array,can:Object},setup(a){const p=a,n=D("comments"),v=D(!1),c=M({body:"",parent_id:null}),A=()=>{c.post(route("comments.store",p.bug.id),{onSuccess:()=>c.reset()})},N=u=>{z.put(route("bugs.update",p.bug.id),{status:u},{preserveScroll:!0})},L=()=>{z.delete(route("bugs.destroy",p.bug.id))},f=u=>new Date(u).toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),T={open:"開放",in_progress:"進行中",resolved:"已解決",closed:"已關閉"};return(u,e)=>(r(),o(m,null,[i(g(O),{title:a.bug.title},null,8,["title"]),i(K,null,{header:x(()=>[t("div",I,[i(g(F),{href:u.route("bugs.index"),class:"text-gray-400 hover:text-gray-900"},{default:x(()=>[...e[7]||(e[7]=[_(" ← ",-1)])]),_:1},8,["href"]),e[8]||(e[8]=t("h2",{class:"text-lg font-medium text-gray-900"},"問題詳情",-1))])]),default:x(()=>{var k,w,C,$,S,V,j,B;return[t("div",J,[t("div",P,[t("div",Q,[t("div",null,[t("div",R,[i(U,{status:a.bug.status},null,8,["status"]),e[10]||(e[10]=t("span",{class:"text-gray-300"},"·",-1)),i(W,{priority:a.bug.priority},null,8,["priority"]),(k=a.bug.tags)!=null&&k.length?(r(),o(m,{key:0},[e[9]||(e[9]=t("span",{class:"text-gray-300"},"·",-1)),t("div",X,[(r(!0),o(m,null,b(a.bug.tags,s=>(r(),o("span",{key:s.id,class:"inline-flex items-center gap-1 text-xs text-gray-600"},[t("span",{class:"h-2 w-2 rounded-full",style:q({backgroundColor:s.color})},null,4),_(" "+l(s.name),1)]))),128))])],64)):d("",!0)]),t("h1",Y,l(a.bug.title),1),t("p",Z,l(a.bug.description),1)]),t("div",tt,[t("div",et,[t("button",{onClick:e[0]||(e[0]=s=>n.value="comments"),class:h(["pb-3 text-sm",n.value==="comments"?"border-b border-gray-900 text-gray-900":"text-gray-500"])}," 留言 ("+l(((w=a.bug.comments)==null?void 0:w.length)||0)+") ",3),t("button",{onClick:e[1]||(e[1]=s=>n.value="attachments"),class:h(["pb-3 text-sm",n.value==="attachments"?"border-b border-gray-900 text-gray-900":"text-gray-500"])}," 附件 ("+l(((C=a.bug.attachments)==null?void 0:C.length)||0)+") ",3),t("button",{onClick:e[2]||(e[2]=s=>n.value="activity"),class:h(["pb-3 text-sm",n.value==="activity"?"border-b border-gray-900 text-gray-900":"text-gray-500"])}," 活動 ",2)]),t("div",st,[n.value==="comments"?(r(),o("div",at,[t("form",{onSubmit:E(A,["prevent"]),class:"mb-6"},[i(H,{modelValue:g(c).body,"onUpdate:modelValue":e[3]||(e[3]=s=>g(c).body=s),placeholder:"新增留言...",rows:3},null,8,["modelValue"]),t("div",ot,[t("button",{type:"submit",disabled:g(c).processing||!g(c).body,class:"text-sm text-gray-900 hover:underline disabled:opacity-50"}," 發表 ",8,rt)])],32),t("div",lt,[(r(!0),o(m,null,b(a.bug.comments,s=>{var y;return r(),o("div",{key:s.id,class:"py-4"},[t("div",dt,[t("span",nt,l((y=s.user)==null?void 0:y.name),1),t("span",it,l(f(s.created_at)),1)]),t("p",ut,l(s.body),1)])}),128)),($=a.bug.comments)!=null&&$.length?d("",!0):(r(),o("p",gt," 尚無留言 "))])])):n.value==="attachments"?(r(),o("div",mt,[t("div",ct,[(r(!0),o(m,null,b(a.bug.attachments,s=>(r(),o("a",{key:s.id,href:u.route("attachments.download",s.id),class:"flex items-center justify-between py-3 text-sm hover:text-gray-900"},[t("span",xt,l(s.original_filename),1),t("span",bt,l((s.size/1024).toFixed(1))+" KB",1)],8,yt))),128)),(S=a.bug.attachments)!=null&&S.length?d("",!0):(r(),o("p",vt," 尚無附件 "))])])):n.value==="activity"?(r(),o("div",ft,[t("div",ht,[(r(!0),o(m,null,b(a.bug.activities,s=>{var y;return r(),o("div",{key:s.id,class:"py-4"},[t("p",pt,[t("span",_t,l((y=s.user)==null?void 0:y.name),1),t("span",kt,l(s.type.replace("_"," ")),1),s.old_value&&s.new_value?(r(),o("span",wt,l(s.old_value)+" → "+l(s.new_value),1)):d("",!0)]),t("p",Ct,l(f(s.created_at)),1)])}),128)),(V=a.bug.activities)!=null&&V.length?d("",!0):(r(),o("p",$t," 尚無活動 "))])])):d("",!0)])])]),t("div",St,[t("div",null,[e[15]||(e[15]=t("h3",{class:"text-sm font-medium text-gray-900"},"詳細資訊",-1)),t("dl",Vt,[t("div",null,[e[11]||(e[11]=t("dt",{class:"text-gray-500"},"回報者",-1)),t("dd",jt,l((j=a.bug.reporter)==null?void 0:j.name),1)]),t("div",null,[e[12]||(e[12]=t("dt",{class:"text-gray-500"},"負責人",-1)),t("dd",Bt,l(((B=a.bug.assignee)==null?void 0:B.name)||"未指派"),1)]),t("div",null,[e[13]||(e[13]=t("dt",{class:"text-gray-500"},"建立時間",-1)),t("dd",Dt,l(f(a.bug.created_at)),1)]),a.bug.resolved_at?(r(),o("div",Ft,[e[14]||(e[14]=t("dt",{class:"text-gray-500"},"解決時間",-1)),t("dd",zt,l(f(a.bug.resolved_at)),1)])):d("",!0)])]),a.can.update?(r(),o("div",At,[e[16]||(e[16]=t("h3",{class:"text-sm font-medium text-gray-900"},"狀態",-1)),t("div",Nt,[(r(!0),o(m,null,b(a.statuses,s=>(r(),o("button",{key:s,onClick:y=>N(s),disabled:a.bug.status===s,class:h(["block w-full py-1.5 text-left text-sm",a.bug.status===s?"text-gray-900":"text-gray-500 hover:text-gray-900"])},l(T[s]||s),11,Lt))),128))])])):d("",!0),a.can.update?(r(),o("div",Tt,[t("div",Mt,[i(g(F),{href:u.route("bugs.edit",a.bug.id),class:"text-sm text-gray-500 hover:text-gray-900"},{default:x(()=>[...e[17]||(e[17]=[_(" 編輯 ",-1)])]),_:1},8,["href"]),a.can.delete?(r(),o("button",{key:0,onClick:e[4]||(e[4]=s=>v.value=!0),class:"text-sm text-gray-500 hover:text-red-600"}," 刪除 ")):d("",!0)])])):d("",!0)])])]),i(G,{show:v.value,onClose:e[6]||(e[6]=s=>v.value=!1),"max-width":"sm"},{default:x(()=>[t("div",Ot,[e[18]||(e[18]=t("h2",{class:"text-lg font-medium text-gray-900"},"刪除問題",-1)),e[19]||(e[19]=t("p",{class:"mt-2 text-sm text-gray-500"},"確定要刪除此問題嗎？",-1)),t("div",qt,[t("button",{onClick:e[5]||(e[5]=s=>v.value=!1),class:"text-sm text-gray-500 hover:text-gray-900"}," 取消 "),t("button",{onClick:L,class:"border border-red-600 px-3 py-1.5 text-sm text-red-600 hover:bg-red-600 hover:text-white"}," 刪除 ")])])]),_:1},8,["show"])]}),_:1})],64))}};export{Ht as default};
